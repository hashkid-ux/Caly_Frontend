import React, { createContext, useContext, useState, useEffect } from 'react';

// Default translations
const translations = {
  en: {
    nav: {
      dashboard: 'Dashboard',
      calls: 'Call History',
      analytics: 'Analytics',
      team: 'Team',
      settings: 'Settings',
      logout: 'Logout',
    },
    common: {
      loading: 'Loading...',
      save: 'Save',
      cancel: 'Cancel',
      delete: 'Delete',
      confirm: 'Confirm',
      close: 'Close',
      search: 'Search...',
      filter: 'Filter',
      noData: 'No data found',
      error: 'Error',
      success: 'Success',
      warning: 'Warning',
      info: 'Info',
      settings: 'Settings',
      profile: 'Profile',
      logout: 'Logout',
      showing: 'Showing ',
    },
    actions: {
      create: 'Create',
      edit: 'Edit',
      update: 'Update',
      remove: 'Remove',
      export: 'Export',
      import: 'Import',
      download: 'Download',
      upload: 'Upload',
    },
    pagination: {
      first: 'First',
      previous: 'Previous',
      next: 'Next',
      last: 'Last',
      of: 'of',
    },
    form: {
      required: 'This field is required',
      email: 'Please enter a valid email',
      password: 'Password must be at least 8 characters',
      confirm: 'Passwords do not match',
    },
    analytics: {
      title: 'Analytics & Insights',
      subtitle: 'Comprehensive performance metrics and KPIs',
      last7Days: 'Last 7 Days',
      last30Days: 'Last 30 Days',
      last90Days: 'Last 90 Days',
      totalCalls: 'Total Calls',
      automationRate: 'Automation Rate',
      avgDuration: 'Avg Duration',
      costSavings: 'Cost Savings',
      callVolumeTrend: 'Call Volume Trend',
      customerSentiment: 'Customer Sentiment',
      aiCallCost: 'AI Call Cost',
      humanCallCost: 'Human Call Cost',
      monthlySavings: 'Monthly Savings',
      forCalls: 'For {count} calls',
      ifAllCalls: 'If all calls were manual',
      withCurrentAutomation: 'With current automation',
      agentPerformance: 'Agent Performance',
      agent: 'Agent',
      callsHandled: 'Calls Handled',
      successRate: 'Success Rate',
      avgHandlingTime: 'Avg Duration',
      loadingAnalytics: 'Loading analytics...',
      failedLoadAnalytics: 'Failed to load analytics. Please try again.',
    },
    dashboard: {
      title: 'Dashboard',
      welcome: 'Welcome back',
      todaysCalls: 'Today\'s Calls',
      automationRate: 'Automation Rate',
      revenue: 'Revenue (Est.)',
      avgDuration: 'Avg Duration',
      callVolume7Days: 'Call Volume (7 Days)',
      revenueDistribution: 'Revenue Distribution',
      noDataAvailable: 'No data available',
      loadingDashboard: 'Loading dashboard...',
      failedLoadDashboard: 'Failed to load dashboard data',
    },
    callHistory: {
      title: 'Call History',
      subtitle: 'All customer calls and interactions',
      searchPlaceholder: 'Search by phone number...',
      filterStatus: 'Filter by Status',
      all: 'All',
      active: 'Active',
      resolved: 'Resolved',
      phoneNumber: 'Phone Number',
      duration: 'Duration',
      startTime: 'Start Time',
      status: 'Status',
      callDetails: 'Call Details',
      loadingCalls: 'Loading calls...',
      failedLoadCalls: 'Failed to load calls. Please try again.',
      noCallsFound: 'No calls found',
    },
    team: {
      title: 'AI Agents',
      subtitle: 'Manage and monitor your AI agent team',
      totalAgents: 'Total Agents',
      activeAgents: 'Active Agents',
      totalCallsTeam: 'Total Calls',
      avgSuccessRate: 'Avg Success Rate',
      agentName: 'Agent Name',
      callsHandled: 'Calls Handled',
      successRate: 'Success Rate',
      avgDuration: 'Avg Duration',
      status: 'Status',
      performanceDetails: 'Performance Details',
      noAgentsFound: 'No agents found',
      configureAgents: 'Configure your AI agents in settings',
    },
    settings: {
      title: 'Settings',
      subtitle: 'Manage company settings and integrations',
      companyInfo: 'Company Information',
      timezone: 'Timezone',
      language: 'Language',
      shopify: 'Shopify Integration',
      exotel: 'Exotel Integration',
      businessRules: 'Business Rules',
      returnWindow: 'Return Window (Days)',
      refundAutoThreshold: 'Refund Auto Threshold',
      cancelWindow: 'Cancel Window (Hours)',
      escalationThreshold: 'Escalation Threshold (Minutes)',
      channels: 'Communication Channels',
      whatsapp: 'WhatsApp',
      sms: 'SMS',
      email: 'Email',
      save: 'Save Changes',
      saving: 'Saving...',
      loadingSettings: 'Loading settings...',
      settingsSaved: 'Settings saved successfully!',
      settingsFailed: 'Failed to save settings. Please try again.',
    },
  },
  es: {
    nav: {
      dashboard: 'Panel de Control',
      calls: 'Historial de Llamadas',
      analytics: 'Análisis',
      team: 'Equipo',
      settings: 'Configuración',
      logout: 'Cerrar Sesión',
    },
    common: {
      loading: 'Cargando...',
      save: 'Guardar',
      cancel: 'Cancelar',
      delete: 'Eliminar',
      confirm: 'Confirmar',
      close: 'Cerrar',
      search: 'Buscar...',
      filter: 'Filtro',
      noData: 'Sin datos',
      error: 'Error',
      success: 'Éxito',
      warning: 'Advertencia',
      info: 'Información',
      settings: 'Configuración',
      profile: 'Perfil',
      logout: 'Cerrar Sesión',
      showing: 'Mostrando ',
    },
    actions: {
      create: 'Crear',
      edit: 'Editar',
      update: 'Actualizar',
      remove: 'Eliminar',
      export: 'Exportar',
      import: 'Importar',
      download: 'Descargar',
      upload: 'Cargar',
    },
    pagination: {
      first: 'Primero',
      previous: 'Anterior',
      next: 'Siguiente',
      last: 'Último',
      of: 'de',
    },
    form: {
      required: 'Este campo es requerido',
      email: 'Por favor ingrese un correo válido',
      password: 'La contraseña debe tener al menos 8 caracteres',
      confirm: 'Las contraseñas no coinciden',
    },
    analytics: {
      title: 'Análisis e Información',
      subtitle: 'Métricas de rendimiento integral y KPIs',
      last7Days: 'Últimos 7 Días',
      last30Days: 'Últimos 30 Días',
      last90Days: 'Últimos 90 Días',
      totalCalls: 'Llamadas Totales',
      automationRate: 'Tasa de Automatización',
      avgDuration: 'Duración Promedio',
      costSavings: 'Ahorro de Costos',
      callVolumeTrend: 'Tendencia de Volumen de Llamadas',
      customerSentiment: 'Sentimiento del Cliente',
      aiCallCost: 'Costo de Llamada IA',
      humanCallCost: 'Costo de Llamada Humana',
      monthlySavings: 'Ahorros Mensuales',
      forCalls: 'Por {count} llamadas',
      ifAllCalls: 'Si todas las llamadas fueran manuales',
      withCurrentAutomation: 'Con automatización actual',
      agentPerformance: 'Rendimiento del Agente',
      agent: 'Agente',
      callsHandled: 'Llamadas Manejadas',
      successRate: 'Tasa de Éxito',
      avgHandlingTime: 'Duración Promedio',
      loadingAnalytics: 'Cargando análisis...',
      failedLoadAnalytics: 'Error al cargar análisis. Intente nuevamente.',
    },
    dashboard: {
      title: 'Panel de Control',
      welcome: 'Bienvenido',
      todaysCalls: 'Llamadas de Hoy',
      automationRate: 'Tasa de Automatización',
      revenue: 'Ingresos (Est.)',
      avgDuration: 'Duración Promedio',
      callVolume7Days: 'Volumen de Llamadas (7 Días)',
      revenueDistribution: 'Distribución de Ingresos',
      noDataAvailable: 'Sin datos disponibles',
      loadingDashboard: 'Cargando panel...',
      failedLoadDashboard: 'Error al cargar datos del panel',
    },
    callHistory: {
      title: 'Historial de Llamadas',
      subtitle: 'Todas las llamadas e interacciones de clientes',
      searchPlaceholder: 'Buscar por número de teléfono...',
      filterStatus: 'Filtrar por Estado',
      all: 'Todas',
      active: 'Activas',
      resolved: 'Resueltas',
      phoneNumber: 'Número de Teléfono',
      duration: 'Duración',
      startTime: 'Hora de Inicio',
      status: 'Estado',
      callDetails: 'Detalles de la Llamada',
      loadingCalls: 'Cargando llamadas...',
      failedLoadCalls: 'Error al cargar llamadas. Intente nuevamente.',
      noCallsFound: 'Sin llamadas encontradas',
    },
    team: {
      title: 'Agentes IA',
      subtitle: 'Administre y monitoree su equipo de agentes IA',
      totalAgents: 'Agentes Totales',
      activeAgents: 'Agentes Activos',
      totalCallsTeam: 'Llamadas Totales',
      avgSuccessRate: 'Tasa de Éxito Promedio',
      agentName: 'Nombre del Agente',
      callsHandled: 'Llamadas Manejadas',
      successRate: 'Tasa de Éxito',
      avgDuration: 'Duración Promedio',
      status: 'Estado',
      performanceDetails: 'Detalles de Rendimiento',
      noAgentsFound: 'Sin agentes encontrados',
      configureAgents: 'Configure sus agentes IA en configuración',
    },
    settings: {
      title: 'Configuración',
      subtitle: 'Administrar configuración e integraciones de la empresa',
      companyInfo: 'Información de la Empresa',
      timezone: 'Zona Horaria',
      language: 'Idioma',
      shopify: 'Integración Shopify',
      exotel: 'Integración Exotel',
      businessRules: 'Reglas de Negocio',
      returnWindow: 'Ventana de Devolución (Días)',
      refundAutoThreshold: 'Umbral de Reembolso Automático',
      cancelWindow: 'Ventana de Cancelación (Horas)',
      escalationThreshold: 'Umbral de Escalada (Minutos)',
      channels: 'Canales de Comunicación',
      whatsapp: 'WhatsApp',
      sms: 'SMS',
      email: 'Correo Electrónico',
      save: 'Guardar Cambios',
      saving: 'Guardando...',
      loadingSettings: 'Cargando configuración...',
      settingsSaved: '¡Configuración guardada exitosamente!',
      settingsFailed: 'Error al guardar la configuración. Intente nuevamente.',
    },
  },
  fr: {
    nav: {
      dashboard: 'Tableau de Bord',
      calls: 'Historique des Appels',
      analytics: 'Analyse',
      team: 'Équipe',
      settings: 'Paramètres',
      logout: 'Déconnexion',
    },
    common: {
      loading: 'Chargement...',
      save: 'Enregistrer',
      cancel: 'Annuler',
      delete: 'Supprimer',
      confirm: 'Confirmer',
      close: 'Fermer',
      search: 'Rechercher...',
      filter: 'Filtrer',
      noData: 'Aucune donnée',
      error: 'Erreur',
      success: 'Succès',
      warning: 'Avertissement',
      info: 'Information',
      settings: 'Paramètres',
      profile: 'Profil',
      logout: 'Déconnexion',
      showing: 'Affichage ',
    },
    actions: {
      create: 'Créer',
      edit: 'Éditer',
      update: 'Mettre à jour',
      remove: 'Supprimer',
      export: 'Exporter',
      import: 'Importer',
      download: 'Télécharger',
      upload: 'Télécharger',
    },
    pagination: {
      first: 'Premier',
      previous: 'Précédent',
      next: 'Suivant',
      last: 'Dernier',
      of: 'de',
    },
    form: {
      required: 'Ce champ est requis',
      email: 'Veuillez entrer un email valide',
      password: 'Le mot de passe doit contenir au moins 8 caractères',
      confirm: 'Les mots de passe ne correspondent pas',
    },
    analytics: {
      title: 'Analyse et Insights',
      subtitle: 'Métriques de performance complètes et KPIs',
      last7Days: 'Derniers 7 Jours',
      last30Days: 'Derniers 30 Jours',
      last90Days: 'Derniers 90 Jours',
      totalCalls: 'Appels Totaux',
      automationRate: 'Taux d\'Automatisation',
      avgDuration: 'Durée Moyenne',
      costSavings: 'Économies de Coûts',
      callVolumeTrend: 'Tendance du Volume d\'Appels',
      customerSentiment: 'Sentiment Client',
      aiCallCost: 'Coût d\'Appel IA',
      humanCallCost: 'Coût d\'Appel Humain',
      monthlySavings: 'Économies Mensuelles',
      forCalls: 'Pour {count} appels',
      ifAllCalls: 'Si tous les appels étaient manuels',
      withCurrentAutomation: 'Avec automatisation actuelle',
      agentPerformance: 'Performance de l\'Agent',
      agent: 'Agent',
      callsHandled: 'Appels Traités',
      successRate: 'Taux de Réussite',
      avgHandlingTime: 'Durée Moyenne',
      loadingAnalytics: 'Chargement des analyses...',
      failedLoadAnalytics: 'Impossible de charger les analyses. Veuillez réessayer.',
    },
    dashboard: {
      title: 'Tableau de Bord',
      welcome: 'Bienvenue',
      todaysCalls: 'Appels Aujourd\'hui',
      automationRate: 'Taux d\'Automatisation',
      revenue: 'Revenu (Est.)',
      avgDuration: 'Durée Moyenne',
      callVolume7Days: 'Volume d\'Appels (7 Jours)',
      revenueDistribution: 'Distribution des Revenus',
      noDataAvailable: 'Aucune donnée disponible',
      loadingDashboard: 'Chargement du tableau de bord...',
      failedLoadDashboard: 'Impossible de charger les données du tableau de bord',
    },
    callHistory: {
      title: 'Historique des Appels',
      subtitle: 'Tous les appels et interactions des clients',
      searchPlaceholder: 'Rechercher par numéro de téléphone...',
      filterStatus: 'Filtrer par Statut',
      all: 'Tous',
      active: 'Actifs',
      resolved: 'Résolus',
      phoneNumber: 'Numéro de Téléphone',
      duration: 'Durée',
      startTime: 'Heure de Début',
      status: 'Statut',
      callDetails: 'Détails de l\'Appel',
      loadingCalls: 'Chargement des appels...',
      failedLoadCalls: 'Impossible de charger les appels. Veuillez réessayer.',
      noCallsFound: 'Aucun appel trouvé',
    },
    team: {
      title: 'Agents IA',
      subtitle: 'Gérez et surveillez votre équipe d\'agents IA',
      totalAgents: 'Agents Totaux',
      activeAgents: 'Agents Actifs',
      totalCallsTeam: 'Appels Totaux',
      avgSuccessRate: 'Taux de Réussite Moyen',
      agentName: 'Nom de l\'Agent',
      callsHandled: 'Appels Traités',
      successRate: 'Taux de Réussite',
      avgDuration: 'Durée Moyenne',
      status: 'Statut',
      performanceDetails: 'Détails de Performance',
      noAgentsFound: 'Aucun agent trouvé',
      configureAgents: 'Configurez vos agents IA dans les paramètres',
    },
    settings: {
      title: 'Paramètres',
      subtitle: 'Gérez les paramètres et les intégrations de l\'entreprise',
      companyInfo: 'Informations de l\'Entreprise',
      timezone: 'Fuseau Horaire',
      language: 'Langue',
      shopify: 'Intégration Shopify',
      exotel: 'Intégration Exotel',
      businessRules: 'Règles Métier',
      returnWindow: 'Fenêtre de Retour (Jours)',
      refundAutoThreshold: 'Seuil de Remboursement Automatique',
      cancelWindow: 'Fenêtre d\'Annulation (Heures)',
      escalationThreshold: 'Seuil d\'Escalade (Minutes)',
      channels: 'Canaux de Communication',
      whatsapp: 'WhatsApp',
      sms: 'SMS',
      email: 'Email',
      save: 'Enregistrer les Modifications',
      saving: 'Enregistrement...',
      loadingSettings: 'Chargement des paramètres...',
      settingsSaved: 'Paramètres enregistrés avec succès!',
      settingsFailed: 'Impossible d\'enregistrer les paramètres. Veuillez réessayer.',
    },
  },
};

const I18nContext = createContext();

export const I18nProvider = ({ children, initialLanguage = 'en' }) => {
  const [language, setLanguage] = useState(() => {
    const saved = localStorage.getItem('language-preference');
    return saved || initialLanguage;
  });

  useEffect(() => {
    localStorage.setItem('language-preference', language);
    document.documentElement.lang = language;
  }, [language]);

  const t = (path, defaultValue = '') => {
    const keys = path.split('.');
    let value = translations[language] || translations.en;

    for (const key of keys) {
      value = value?.[key];
    }

    return value || defaultValue || path;
  };

  const changeLanguage = (lang) => {
    if (translations[lang]) {
      setLanguage(lang);
    }
  };

  const addTranslations = (lang, newTranslations) => {
    if (translations[lang]) {
      translations[lang] = {
        ...translations[lang],
        ...newTranslations,
      };
    }
  };

  return (
    <I18nContext.Provider value={{ language, t, changeLanguage, addTranslations }}>
      {children}
    </I18nContext.Provider>
  );
};

export const useI18n = () => {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error('useI18n must be used within I18nProvider');
  }
  return context;
};
